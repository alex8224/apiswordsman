<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Management Platform</title>
    <link rel="stylesheet" href="../static/element-ui.min.css">
    <link rel="stylesheet" href="../static/codemirror.min.css">
    <link rel="stylesheet" href="../styles.css">
</head>

<body>
<div id="app">
    <div class="main">
        <div class="content">
            <div id="api01">文档修订记录</div>

            <div v-for="tableObj in tableList">
                <!-- :header-row-class-name="blueHeader1" -->
                <div v-if="tableObj.type =='image'">
                    <div :id="tableObj.name" style="margin-top: 20px;">{{ tableObj.name }}</div>
                </div>
                <div v-if="tableObj.type=='image'">
                    <img :src="tableObj.imgsrc" />
                </div>
                <div v-if="tableObj.revisions.length > 0">
                    <el-table :data="changeData" style="margin-top: 20px;"
                              :header-cell-style="{ backgroundColor: 'rgba(10, 132, 255, 1)',color:'#fff'}">
                        <el-table-column prop="version" label="版本号"></el-table-column>
                        <el-table-column prop="changeStatus" label="*变化状态"></el-table-column>
                        <el-table-column prop="desc" label="简要说明"></el-table-column>
                        <el-table-column prop="date" label="日期"></el-table-column>
                        <el-table-column prop="changer" label="变更人"></el-table-column>
                        <el-table-column prop="auditDate" label="批准日期"></el-table-column>
                        <el-table-column prop="auditor" label="批准人"></el-table-column>
                    </el-table>
                </div>
                <div v-if="tableObj.basicInfo.length > 0">
                    <div :id="tableObj.name" style="margin-top: 20px;">{{ tableObj.name }}</div>
                    <div id="api02" style="margin-top: 20px;">服务基本信息</div>
                    <el-table :data="tableObj.basicInfo" :show-header="showHeader" style="margin-top: 20px;">
                        <el-table-column prop="label" label=" " width="200" :class-name="blueHeader()">
                        </el-table-column>
                        <el-table-column label=" ">
                            <template slot-scope="scope">
                                <div v-html="formatValue(scope.row.value)"></div>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>

                <div v-if="tableObj.tableData.length > 0">
                    <div id="api03" style="margin-top: 20px;">请求消息描述</div>
                    <el-table :data="tableObj.tableData" style="width: 100%" :show-header="showHeader"
                              :row-class-name="blueHeader1">
                        <el-table-column prop="label" label=" " width="200">
                            <template slot-scope="scope">
                                <div v-if="scope.$index === 14" ref="xmlEditor">
                                    {{renderXML(scope.row.label)}}
                                </div>
                                <span v-else>{{scope.row.label}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="columnName" label=" " width="200">
                        </el-table-column>
                        <el-table-column prop="columnDesc" label=" " width="200">
                        </el-table-column>
                        <el-table-column prop="columnType" label=" " width="200">
                        </el-table-column>
                        <el-table-column prop="isRequired" label=" " width="200">
                        </el-table-column>
                        <el-table-column prop="demp" label=" " width="200">
                        </el-table-column>
                    </el-table>

                    <div id="api04" style="margin-top: 20px;">响应消息描述</div>
                    <el-table :data="tableObj.responseTableData" style="width: 100%" :show-header="showHeader"
                              :row-class-name="blueHeader1">
                        <el-table-column prop="label" label=" " width="200">
                            <template slot-scope="scope">
                                <div v-if="scope.$index === 14" ref="xmlEditor">
                                    {{renderXML(scope.row.label)}}
                                </div>
                                <span v-else>{{scope.row.label}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="columnName" label=" " width="200">
                        </el-table-column>
                        <el-table-column prop="columnDesc" label=" " width="200">
                        </el-table-column>
                        <el-table-column prop="columnType" label=" " width="200">
                        </el-table-column>
                        <el-table-column prop="isRequired" label=" " width="200">
                        </el-table-column>
                        <el-table-column prop="demp" label=" " width="200">
                        </el-table-column>
                    </el-table>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../static/vue@2.min.js"></script>
<script src="../static/element-ui.min.js"></script>
<script src="../static/codemirror.min.js"></script>
<script src="../static/xml.min.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            timeInfo: {
                today: "",
                here: "",
                week: ""
            },
            version: '',
            filterText: '',
            treeData: [],
            defaultProps: {
                children: 'children',
                label: 'nodeName'
            },
            showHeader: false,
            changeData: [],
            tableList: [{"name":"医技状态回传(检查、手术、病理)消息","revisions":[],"tableData":[{"columnType":"","isRequired":"","demp":"","label":"字段描述","columnDesc":"","columnName":""},{"columnType":"类型","isRequired":"必填","demp":"示例/说明","label":"段","columnDesc":"字段描述","columnName":"字段名"},{"columnType":"MSH","isRequired":"是","demp":"","label":"","columnDesc":"MSH段","columnName":"MSH"},{"columnType":"","isRequired":"","demp":"","label":"∟MSH","columnDesc":"","columnName":""},{"columnType":"ST","isRequired":"是","demp":"","label":"","columnDesc":"","columnName":"字段分隔符"},{"columnType":"ST","isRequired":"是","demp":"^^~\\&","label":"","columnDesc":"","columnName":"编码字符"},{"columnType":"HD","isRequired":"是","demp":"HIS","label":"","columnDesc":"","columnName":"发送方标识"},{"columnType":"","isRequired":"是","demp":"ESB","label":"","columnDesc":"","columnName":"发送设备"},{"columnType":"HD","isRequired":"否","demp":"","label":"","columnDesc":"","columnName":"接收方标识"},{"columnType":"","isRequired":"否","demp":"","label":"","columnDesc":"","columnName":"接收方设备"},{"columnType":"TS","isRequired":"是","demp":"20211224232110","label":"","columnDesc":"","columnName":"消息发送时间"},{"columnType":"MSG","isRequired":"是","demp":"ORM^O01^ORM_O01","label":"","columnDesc":"","columnName":"消息类型"},{"columnType":"ST","isRequired":"是","demp":"","label":"","columnDesc":"","columnName":"消息ID"},{"columnType":"ST","isRequired":"是","demp":"P","label":"","columnDesc":"","columnName":"消息处理ID"},{"columnType":"VID","isRequired":"是","demp":"2.6","label":"","columnDesc":"","columnName":"HL7版本号"},{"columnType":"ST","isRequired":"是","demp":"","label":"","columnDesc":"厂商授权码","columnName":"授权码"},{"columnType":"ST","isRequired":"是","demp":"V1.0","label":"","columnDesc":"接口版本号","columnName":"接口版本号"},{"columnType":"NM","isRequired":"否","demp":"","label":"","columnDesc":"","columnName":"序号"},{"columnType":"ID","isRequired":"是","demp":"NE","label":"","columnDesc":"","columnName":"确认类型"},{"columnType":"ID","isRequired":"是","demp":"AL","label":"","columnDesc":"","columnName":"应用确认类型"},{"columnType":"ID","isRequired":"是","demp":"UTF-8","label":"","columnDesc":"","columnName":"字符集"},{"columnType":"PID","isRequired":"是","demp":"","label":"","columnDesc":"PID段","columnName":"PID"},{"columnType":"","isRequired":"","demp":"","label":"∟PID","columnDesc":"","columnName":""},{"columnType":"CX","isRequired":"是","demp":"9000080093","label":"","columnDesc":"","columnName":"患者ID"},{"columnType":"CX","isRequired":"是","demp":"4302013198703091316","label":"","columnDesc":"","columnName":"导引介质编码"},{"columnType":"ID","isRequired":"否","demp":"参见 PIX0001 住院患者必须填写身份证","label":"","columnDesc":"","columnName":"导引介质类型"},{"columnType":"XPN","isRequired":"是","demp":"黄 安 琪 ^^^HUANG AN QI ","label":"","columnDesc":"","columnName":"患者姓名"},{"columnType":"TS","isRequired":"是","demp":"199204150000000","label":"","columnDesc":"","columnName":"出生日期"},{"columnType":"IS","isRequired":"是","demp":"1 参见GB2261-80","label":"","columnDesc":"","columnName":"性别"},{"columnType":"ST","isRequired":"否","demp":"1 参见GB2260-2007","label":"","columnDesc":"","columnName":"现住地址-小区楼栋"},{"columnType":"ST","isRequired":"否","demp":"参见GB2260-2007","label":"","columnDesc":"","columnName":"现住地址-村社区"},{"columnType":"ST","isRequired":"否","demp":"参见GB2260-2007","label":"","columnDesc":"","columnName":"现住地址-乡镇街道"},{"columnType":"ST","isRequired":"否","demp":"参见GB2260-2007","label":"","columnDesc":"","columnName":"现住地址-县编码"},{"columnType":"ST","isRequired":"否","demp":"参见GB2260-2007","label":"","columnDesc":"","columnName":"现住地址-市编码"},{"columnType":"ST","isRequired":"否","demp":"参见GB2260-2007","label":"","columnDesc":"","columnName":"现住地址-省编码"},{"columnType":"ST","isRequired":"否","demp":"13800138000","label":"","columnDesc":"","columnName":"电话号码"},{"columnType":"CE","isRequired":"否","demp":"","label":"","columnDesc":"","columnName":"婚姻状况"},{"columnType":"ST","isRequired":"否","demp":"","label":"","columnDesc":"","columnName":"身份证号"},{"columnType":"CE","isRequired":"否","demp":"^汉族^1 参见GB3304-91","label":"","columnDesc":"","columnName":"民族"},{"columnType":"PV1","isRequired":"是","demp":"","label":"","columnDesc":"PV1段","columnName":"PV1"},{"columnType":"","isRequired":"","demp":"","label":"∟PV1","columnDesc":"","columnName":""},{"columnType":"IS","isRequired":"是","demp":"2 参见YB0026","label":"","columnDesc":"","columnName":"患者类别"},{"columnType":"PL","isRequired":"是","demp":"1300110","label":"","columnDesc":"门诊为就诊科室，住院为患者所在科室","columnName":"科室"},{"columnType":"PL","isRequired":"否","demp":"1300110","label":"","columnDesc":"当为住院患者时必填","columnName":"病区"},{"columnType":"PL","isRequired":"否","demp":"71-T2","label":"","columnDesc":"当为住院患者时必填","columnName":"床位"},{"columnType":"IS","isRequired":"否","demp":"","label":"","columnDesc":"参见RC026","columnName":"入院途径"},{"columnType":"XCN","isRequired":"是","demp":"","label":"","columnDesc":"门诊为就诊医生，住院为主治医生","columnName":"就诊医生"},{"columnType":"IS","isRequired":"是","demp":"0","label":"","columnDesc":"门诊使用 0 初诊 1 复诊","columnName":"复诊标识"},{"columnType":"SI","isRequired":"否","demp":"","label":"","columnDesc":"1 同意 2 拒绝","columnName":"知情同意标识"},{"columnType":"IS","isRequired":"否","demp":"","label":"","columnDesc":"参见EMR0017","columnName":"入院情况"},{"columnType":"CX","isRequired":"是","demp":"4","label":"","columnDesc":"","columnName":"就诊次数"},{"columnType":"IS","isRequired":"否","demp":"4","label":"","columnDesc":"","columnName":"重保标识"},{"columnType":"IS","isRequired":"是","demp":"H0002","label":"","columnDesc":"","columnName":"院区编码"},{"columnType":"TS","isRequired":"是","demp":"20220105100100","label":"","columnDesc":"门诊为就诊时间，住院为入院时间","columnName":"就诊时间"},{"columnType":"CX","isRequired":"否","demp":"","label":"","columnDesc":"住院患者使用","columnName":"病历号"},{"columnType":"ORC","isRequired":"是","demp":"","label":"","columnDesc":"ORC段","columnName":"ORC"},{"columnType":"","isRequired":"","demp":"","label":"∟ORC","columnDesc":"","columnName":""},{"columnType":"ID","isRequired":"是","demp":"SC","label":"","columnDesc":"","columnName":"医嘱控制码"},{"columnType":"EI","isRequired":"是","demp":"02D2021122400534","label":"","columnDesc":"","columnName":"医技申请单号^^医嘱号"},{"columnType":"EI","isRequired":"否","demp":"","label":"","columnDesc":"","columnName":"执行者单号"},{"columnType":"ID","isRequired":"是","demp":"60","label":"","columnDesc":"参见附录检查状态","columnName":"检查状态"},{"columnType":"TS","isRequired":"是","demp":"20211224233837","label":"","columnDesc":"","columnName":"操作时间（实际执行时间）"},{"columnType":"CWE","isRequired":"否","demp":"10161224083`CT","label":"","columnDesc":"","columnName":"影像号^设备类型"},{"columnType":"XCN","isRequired":"是","demp":"101849","label":"","columnDesc":"","columnName":"第一操作人编码"},{"columnType":"ST","isRequired":"是","demp":"王菲","label":"","columnDesc":"","columnName":"第一操作人名字"},{"columnType":"XCN","isRequired":"否","demp":"A1996","label":"","columnDesc":"","columnName":"第二操作人编码"},{"columnType":"ST","isRequired":"否","demp":"刘欢","label":"","columnDesc":"","columnName":"第二操作人名字"},{"columnType":"ID","isRequired":"是","demp":"D","label":"","columnDesc":"参见 YB0056","columnName":"医嘱类型"},{"columnType":"XON","isRequired":"否","demp":"放射科CT室^^212112","label":"","columnDesc":"","columnName":"执行科室^^科室码"}],"type":"api","responseTableData":[{"columnType":"","isRequired":"","demp":"","label":"字段描述","columnDesc":"","columnName":""},{"columnType":"类型","isRequired":"必填","demp":"示例/说明","label":"段","columnDesc":"字段描述","columnName":"字段名"},{"columnType":"ID","isRequired":"是","demp":"AE","label":"","columnDesc":"ACK 交互模式的接收确认使用 AA、AE、AR，其他任何模式，均使用 CA、CE、CR。","columnName":"确认代码"},{"columnType":"CX","isRequired":"是","demp":"MSG202103181524","label":"","columnDesc":"接收的发送系统消息的 MSH-10 中的消息控制 ID","columnName":"消息控制 ID"},{"columnType":"ID","isRequired":"否","demp":"","label":"","columnDesc":"消息提示的自定义内容","columnName":"说明信息"},{"columnType":"NM","isRequired":"否","demp":"1","label":"","columnDesc":"用于顺序消息发送","columnName":"期望序列号"},{"columnType":"ST","isRequired":"是","demp":"E","label":"","columnDesc":"自定义说明","columnName":"程序错误代码"},{"columnType":"ST","isRequired":"否","demp":"错误说明","label":"","columnDesc":"","columnName":"错误说明"}],"basicInfo":[{"label":"提供商","value":"EMR"},{"label":"协议类型","value":"WEBSERVICE、TCP/IP、HL7"},{"label":"请求服务编码","value":"ORL^O01^ORL_O01"},{"label":"应答服务编码","value":"ACK^O01"},{"label":"使用场景","value":""},{"label":"调用说明","value":"当检查预约系统/执行系统处理检查申请时，导致检查单状态发生变化，发送此消息。\n检查申请单:检查项目（1:N），一个检查申请单的多个项目状态必须同时变化"}]}],
            mergeRows: [],
            editor: null,
        },
        computed: {
            time() {
                return this.timeInfo.today + " " + this.timeInfo.week + " " + this.timeInfo.here
            },
        },
        created() {
            setInterval(() => {
                this.getTimeInfo()
            }, 1000);
        },
        destroyed() {
            this.editor = null;
        },
        methods: {
            formatValue(value) {
              if (!value) return '';
                  return value.replace(/\n/g, '<br/>');
            },
            renderXML(val) {
                if (val) {
                    this.$nextTick(() => {
                        if (!this.editor) {
                            this.$refs.xmlEditor.value = '';
                            this.editor = CodeMirror.fromTextArea(this.$refs.xmlEditor, {
                                lineNumbers: true, // 显示行号
                                mode: "application/xml", // 设置语言模式为XML
                                readOnly: true, // 设置编辑器为只读模式
                                lineWrapping: true, // 自动换行
                                smartIndent: true, // 设置初始的XML数据
                            });
                            this.editor?.setValue(val);
                            setTimeout(() => {
                                this.editor?.refresh();
                            }, 2000);
                        }
                    })
                }
            },
            arraySpanMethod({ row, column, rowIndex, columnIndex }) {
                if (this.mergeRows.includes(rowIndex)) {
                    if (columnIndex === 0) {
                        return [1, 2];
                    } else if (columnIndex === 1) {
                        return [0, 0];
                    }
                }
                if (rowIndex > 13) {
                    if (columnIndex === 0) {
                        if (rowIndex === 14) {
                            return {
                                rowspan: 4,
                                colspan: 6
                            };
                        } else {
                            return {
                                rowspan: 0,
                                colspan: 0
                            };
                        }
                    }
                }
            },
            getTimeInfo() {
                const e = new Date();
                const t = e.getHours() < 10 ? "0" + e.getHours() : e.getHours();
                const n = e.getMinutes() < 10 ? "0" + e.getMinutes() : e.getMinutes();
                const a = e.getSeconds() < 10 ? "0" + e.getSeconds() : e.getSeconds();
                const o = "".concat(t, ":").concat(n, ":").concat(a);
                const r = "".concat(e.getFullYear(), "年").concat(e.getMonth() + 1, "月").concat(e.getDate(), "日");
                let c = "";
                switch (e.getDay()) {
                    case 0:
                        c = "周日";
                        break;
                    case 1:
                        c = "周一";
                        break;
                    case 2:
                        c = "周二";
                        break;
                    case 3:
                        c = "周三";
                        break;
                    case 4:
                        c = "周四";
                        break;
                    case 5:
                        c = "周五";
                        break;
                    case 6:
                        c = "周六";
                        break
                }
                this.timeInfo = {
                    today: r,
                    here: o,
                    week: c
                }
            },
            filterNode(value, data) {
                if (!value) return true;
                return data.nodeName.includes(value);
            },
            handleNodeClick(data) {
                const a = document.createElement('a');
                a.href = "#" + data?.id;
                a.click();
            },
            blueHeader() {
                return 'blue-header';
            },
            blueHeader1({ row, column, rowIndex, columnIndex }) {
                if (rowIndex === 0) {
                    return 'blue-header';
                }
            },
        }
    });
</script>
</body>

</html>