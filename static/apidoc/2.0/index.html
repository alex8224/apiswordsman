<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Management Platform</title>
    <link rel="stylesheet" href="../static/element-ui.min.css">
    <link rel="stylesheet" href="../static/codemirror.min.css">
    <link rel="stylesheet" href="../styles.css">
</head>

<body>
<div id="app">
    <div class="main">
        <div class="sidebar">
            <el-input placeholder="" v-model="filterText" class="filter-input">
                <el-button slot="append" icon="el-icon-search" @click="filterTree"></el-button>
            </el-input>
            <el-tree :data="filteredTreeData" :props="defaultProps" :filter-node-method="filterNode"
                     @node-click="handleNodeClick" node-key="path" default-expand-all>
            </el-tree>
        </div>
        <div class="content">
            <iframe id="contentFrame" src="" frameborder="0" style="width: 100%; height: 100%;"></iframe>
        </div>
    </div>
</div>
<script src="../static/vue@2.min.js"></script>
<script src="../static/element-ui.min.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            timeInfo: {
                today: "",
                here: "",
                week: ""
            },
            version: '',
            filterText: '',
            treeData: [
                {
                    "path": "/data/api/01 API管理平台",
                    "id": "api01",
                    "length": 1,
                    "isDir": true,
                    "nodeName": "API管理平台",
                    "children": [{"children":[{"isDir":false,"nodeName":"Cdss查询","path":"某某接口分类.html#Cdss查询"}],"isDir":true,"nodeName":"某某接口分类","path":"某某接口分类.html"},{"children":[{"isDir":false,"nodeName":"检查开立流程图11","path":"资源嵌入.html#检查开立流程图11"},{"isDir":false,"nodeName":"首页背景","path":"资源嵌入.html#首页背景"},{"isDir":false,"nodeName":"检查开立流程图","path":"资源嵌入.html#检查开立流程图"}],"isDir":true,"nodeName":"资源嵌入","path":"资源嵌入.html"},{"children":[{"isDir":false,"nodeName":"预约号源查询","path":"挂号相关1.html#预约号源查询"}],"isDir":true,"nodeName":"挂号相关1","path":"挂号相关1.html"},{"children":[{"isDir":false,"nodeName":"预约号源查询","path":"挂号相关.html#预约号源查询"}],"isDir":true,"nodeName":"挂号相关","path":"挂号相关.html"},{"children":[{"isDir":false,"nodeName":"检查开立","path":"医技业务接口.html#检查开立"},{"isDir":false,"nodeName":"医技状态回传(检查、手术、病理)","path":"医技业务接口.html#医技状态回传(检查、手术、病理)"},{"isDir":false,"nodeName":"检验报告发布/撤销","path":"医技业务接口.html#检验报告发布/撤销"},{"isDir":false,"nodeName":"报告文件查询","path":"医技业务接口.html#报告文件查询"}],"isDir":true,"nodeName":"医技业务接口","path":"医技业务接口.html"},{"children":[{"isDir":false,"nodeName":"cdss查询","path":"厂家接入.html#cdss查询"}],"isDir":true,"nodeName":"厂家接入","path":"厂家接入.html"}],
                }
            ],
            defaultProps: {
                children: 'children',
                label: 'nodeName'
            }
        },
        computed: {
            time() {
                return this.timeInfo.today + " " + this.timeInfo.week + " " + this.timeInfo.here;
            },
            filteredTreeData() {
                if (!this.filterText) {
                    return this.treeData;
                }
                return this.filterTreeData(this.treeData, this.filterText);
            }
        },
        created() {
            setInterval(() => {
                this.getTimeInfo()
            }, 1000);
        },
        methods: {
            getTimeInfo() {
                const e = new Date();
                const t = e.getHours() < 10 ? "0" + e.getHours() : e.getHours();
                const n = e.getMinutes() < 10 ? "0" + e.getMinutes() : e.getMinutes();
                const a = e.getSeconds() < 10 ? "0" + e.getSeconds() : e.getSeconds();
                const o = "".concat(t, ":").concat(n, ":").concat(a);
                const r = "".concat(e.getFullYear(), "年").concat(e.getMonth() + 1, "月").concat(e.getDate(), "日");
                let c = "";
                switch (e.getDay()) {
                    case 0: c = "周日"; break;
                    case 1: c = "周一"; break;
                    case 2: c = "周二"; break;
                    case 3: c = "周三"; break;
                    case 4: c = "周四"; break;
                    case 5: c = "周五"; break;
                    case 6: c = "周六"; break;
                }
                this.timeInfo = {
                    today: r,
                    here: o,
                    week: c
                }
            },
            filterTree() {
                // 手动触发树过滤方法
                this.$refs.tree.filter(this.filterText);
            },
            filterNode(value, data) {
                if (!value) return true;
                return data.nodeName.includes(value);
            },
            handleNodeClick(data) {
                const iframe = document.getElementById('contentFrame');
                iframe.src = data.path;
            },
             filterTreeData(tree, filterText) {
                return tree.map(node => {
                    const children = node.children ? this.filterTreeData(node.children, filterText) : [];
                    if (node.nodeName.includes(filterText) || children.length > 0) {
                        return {
                            ...node,
                            children
                        };
                    }
                    return null;
                }).filter(node => node);
            }
        }
    });
</script>
</body>

</html>
